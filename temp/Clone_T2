
<body>
    <!-- Logo
    <img src="https://upload.wikimedia.org/wikipedia/vi/thumb/b/bf/Logo_HUET.svg/1200px-Logo_HUET.svg.png" alt="Logo"
        class="logo"> -->

    <!-- <header>
        <h1>WAREHOUSE MANAGEMENT SYSTEM</h1>
    </header>

    Menu của tôi -->
    <nav>
        <!-- <a href="#" id="menuTraCuu">LOCATION</a>
        <button id="floor1Button" style="display: none;">Floor 1</button> -->
        
 
        <button id="floor2Button" style="display: none;">Floor 2</button>


        
        <!-- <a href="#" id="menuC">STATISTICS</a>
        <a href="#" id="menuB">SET ANCHOR POSITION</a>
        
        <a href="#" id="menuA">ABOUT US</a> -->
    </nav>

    <!--Nút Floor2-->
    <div id="floor2ButtonContainer"></div>
    

    <!-- Bảng Thông tin Món hàng trong menu Statistics
    <div id="tableContainer" class="centered-table" style="display: none;">
        <table id="productTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Building</th>
                    <th>Floor</th>
                    <th>Tag</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody id="productTableBody"></tbody>
        </table>
        Thêm nút "Xuất thống kê"
        <button id="exportButton" class="export-button">Export Statistics</button>
    </div>  -->
    

    <!-- Footer
    <div class="bottom-text">Graduation Thesis _ Ware House Management System </div> -->

    
    <!--Phần này để hiển thị anchor dưới dạng image-->
    <div id="rectangle2">
        <div id="product4" class="product"></div>
        <div id="product5" class="product"></div>
        <div id="product6" class="product"></div>
        <img src="https://toppng.com/uploads/preview/instagram-icon-png-download-white-logo-free-social-instagram-logo-vector-2017-1156285509326avakqhwk.png"
        alt="anchor 5" class="anchor" id="anchor5">
        <img src="https://toppng.com/uploads/preview/instagram-icon-png-download-white-logo-free-social-instagram-logo-vector-2017-1156285509326avakqhwk.png"
        alt="anchor 6" class="anchor" id="anchor6">
        <img src="https://toppng.com/uploads/preview/instagram-icon-png-download-white-logo-free-social-instagram-logo-vector-2017-1156285509326avakqhwk.png"
        alt="anchor 7" class="anchor" id="anchor7">
        <img src="https://toppng.com/uploads/preview/instagram-icon-png-download-white-logo-free-social-instagram-logo-vector-2017-1156285509326avakqhwk.png"
        alt="anchor 8" class="anchor" id="anchor8">
    </div>

    <!-- Phần này để nhập tọa độ cho anchor
    <div id="anchorDetails" style="display: none;">
        <label for="xCoordinate">X Coordinates:</label>
        <input type="text" id="xCoordinate" placeholder="Enter X coordinates">
    
        <label for="yCoordinate">Y Coordinates:</label>
        <input type="text" id="yCoordinate" placeholder="Enter Y coordinates">
    
        <button id="saveCoordinates">Lưu</button>
    </div>
     -->
    <div id="floor2InfoContainer" class="floor2-info-container" style="display: none;">
        <!-- Nội dung thông tin sẽ được thêm vào đây bằng JavaScript -->
    </div>
    
    

    <!-- Tải hai tệp JavaScript từ Firebase SDK
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-database.js"></script> -->

    
    
    <script>
        // //Cấu hình Firebase    
        // const firebaseConfig = {
        //     apiKey: "AIzaSyDsZGUIWm5X8i79CnSnJKwlv4_Pu3q3iuc",
        //     authDomain: "myfirstfb-65c63.firebaseapp.com",
        //     databaseURL: "https://myfirstfb-65c63-default-rtdb.asia-southeast1.firebasedatabase.app",
        //     projectId: "myfirstfb-65c63",
        //     storageBucket: "myfirstfb-65c63.appspot.com",
        //     messagingSenderId: "290610857576",
        //     appId: "1:290610857576:web:593011b529606c2b611ddd",
        //     measurementId: "G-55Z9TR5GK7"
        // };

        // firebase.initializeApp(firebaseConfig);
        // var db = firebase.database();

        // //Theo dõi trạng thái cái phần tử trên trang Web
        // var isElementsVisible = false;
        
        //--------------------LOCATION-------------------------
        
        //Truy cập đến map trong menutracuu
        var rectangle2Element = document.getElementById('rectangle2');
        //Theo dõi trạng thái của Button floor 2
        var isFloor2Clicked = false;
        //Hiển thị product trên Map1
        document.querySelectorAll('.product').forEach(function (product, index) {
            product.style.display = 'block';
            var productId = 'product' + (index + 1);

            db.ref('/Building 1/floor2/product').once('value', function(productSnapshot) {
                updateproductPosition(productSnapshot.child(productId).val(), product.id);
            });

            product.addEventListener('click', function () {
                showProductDetails(productId, 'productDetails');
            });
        });
        //Hiển thị anchor trên map2
        document.querySelectorAll('.anchor').forEach(function (anchor, index) {
            anchor.style.display = 'block';
            var anchorId = 'anchor' + (index + 1);

            db.ref('/Building 1/floor2/anchor').once('value', function(anchorSnapshot) {
                updateAnchorPosition(anchorSnapshot.child(anchorId).val(), anchor.id);
            });

        });
        //Khi bắt đầu, các phần tử rectangle2, product, anchor ẩn đi. 
        window.onload = function() {
            rectangle2Element.style.display = 'none';
            document.querySelectorAll('.product').forEach(function (product) {
                product.style.display = 'none';
            });
            document.querySelectorAll('.anchor').forEach(function (anchor) {
                anchor.style.display = 'none';
            });
        }
        // Khi bắt đầu, các phần tử rectangle2, product, anchor ẩn đi. 
        var menuTraCuu = document.getElementById('menuTraCuu');
        rectangle2Element.style.display = 'none';
        document.querySelectorAll('.product').forEach(function (product) {
            product.style.display = 'none';
        });
        document.querySelectorAll('.anchor').forEach(function (anchor) {
            anchor.style.display = 'none';
        });

        // Lắng nghe sự kiện click vào liên kết "Location"
        menuTraCuu.addEventListener('click', function() {
            // Hiển thị nút "Tầng 2" khi click vào liên kết "Location"
            floor2Button.style.display = 'block';
            // Đặt trạng thái của nút "Tầng 2" về false khi click vào liên kết "Location"
            isFloor2Clicked = false;
        });
        //Nút Floor 2
        menuTraCuu.addEventListener('click', function() {
            // Tạo một phần tử button mới
            var floor2Button = document.createElement('button');
            floor2Button.textContent = 'Floor 2';
            floor2Button.id = 'floor2Button';

            // Thêm sự kiện click cho nút "Floor 2" nếu bạn muốn xử lý một hành động cụ thể khi nút này được click
            var floor2Button = document.getElementById('floor2Button');

            floor2Button.addEventListener('click', function() {
                // Nếu chưa click vào nút "Tầng 2" trước đó
                if (!isFloor2Clicked) {
                    // Hiển thị các phần tử khi click vào nút "Tầng 1"
                    rectangle2Element.style.display = 'block';
                    document.querySelectorAll('.product').forEach(function (product) {
                        product.style.display = 'block';
                    });
                    document.querySelectorAll('.anchor').forEach(function (anchor) {
                        anchor.style.display = 'block';
                    });
                    
                    // Cập nhật trạng thái đã click vào nút "Tầng 2"
                    isFloor2Clicked = true;
                } else {
                    // Nếu click vào nút "Tầng 2" trước đó, ấn vào nút lần nữa sẽ ẩn đi các phần tử
                    rectangle2Element.style.display = 'none';
                    document.querySelectorAll('.product').forEach(function (product) {
                        product.style.display = 'none';
                    });
                    document.querySelectorAll('.anchor').forEach(function (anchor) {
                        anchor.style.display = 'none';
                    });
                    
                    // Cập nhật trạng thái đã click vào nút "Tầng 2"
                    isFloor2Clicked = false;
                }
            });


            // Thêm nút "Floor 2" vào phần tử chứa
            var floor2ButtonContainer = document.getElementById('floor2ButtonContainer');
            floor2ButtonContainer.innerHTML = ''; // Xóa bất kỳ nút nào đã tồn tại trước đó
            floor2ButtonContainer.appendChild(floor2Button);
        });



        
        //Show pop-up khi click vào anchor ở Location
        function showAnchorDetails(anchorId, anchorDetailsKey) {
            db.ref('/Building 1/floor2/anchor/' + anchorId).once('value', function (snapshot) {
                var data = snapshot.val();
                if (data && data.coordinates) {
                    var coordinates = data.coordinates;
                    Swal.fire({
                        title: 'Anchor informations',
                        html: `
                            <p><strong>X Coordinates:</strong> ${coordinates.x || 'N/A'}</p>
                            <p><strong>Y Coordinates:</strong> ${coordinates.y || 'N/A'}</p>
                        `,
                        showCloseButton: true,
                        showConfirmButton: false,
                        backdrop: false,
                        customClass: {
                            popup: 'custom-popup'
                        }
                    });
                } else {
                    Swal.fire({
                        title: 'Anchor informations',
                        html: `
                            <p>Anchor details not found.</p>
                        `,
                        showCloseButton: true,
                        showConfirmButton: false,
                        backdrop: false,
                        customClass: {
                            popup: 'custom-popup'
                        }
                    });
                }
            });
        }
        //MENU POSISTION
        var isRectangle2Visible = false;
        // Xử lý sự kiện click vào nút "POSISTION"
        document.getElementById('menuTraCuu').addEventListener('click', function () {
            if (!isRectangle2Visible) {
                // Hiển thị rectangle2, product và anchor
                rectangle2Element.style.display = 'block';
                document.querySelectorAll('.product').forEach(function (product, index) {
                    product.style.display = 'block';
                });
                document.querySelectorAll('.anchor').forEach(function (anchor, index) {
                    anchor.style.display = 'block';
                });
                
                // Hiển thị floor2InfoContainer
                document.getElementById('floor2InfoContainer').style.display = 'block';
                
                // Cập nhật trạng thái của biến isTableVisible thành true
                isTableVisible = true;

                // Cập nhật trạng thái của rectangle2
                isRectangle2Visible = true;
            } else {
                // Ẩn rectangle2, product và anchor
                rectangle2Element.style.display = 'none';
                document.querySelectorAll('.product').forEach(function (product) {
                    product.style.display = 'none';
                });
                document.querySelectorAll('.anchor').forEach(function (anchor) {
                    anchor.style.display = 'none';
                });

                // Ẩn floor2InfoContainer
                document.getElementById('floor2InfoContainer').style.display = 'none';
                
                // Đặt trạng thái của biến isTableVisible thành false
                isTableVisible = false;

                // Cập nhật trạng thái của rectangle2
                isRectangle2Visible = false;
            }
        });
        // //Dùng để hiển thị Anchors và Products
        // function updateAnchorPosition(anchorSnapshot, anchorId) {
        //     var anchorElement = document.getElementById(anchorId);
        //     var xCoordinate = anchorSnapshot.val().coordinates.x || 0;
        //     var yCoordinate = anchorSnapshot.val().coordinates.y || 0;

        //     anchorElement.style.left = xCoordinate + 'px';
        //     anchorElement.style.top = yCoordinate + 'px';
        // }

        // function updateproductPosition(productSnapshot, productId) {
        //     var productElement = document.getElementById(productId);
        //     var xCoordinate = productSnapshot.val().coordinates.x || 0;
        //     var yCoordinate = productSnapshot.val().coordinates.y || 0;

        //     productElement.style.left = xCoordinate + 'px';
        //     productElement.style.top = yCoordinate + 'px';
        // }



        //Giúp ẩn đi hộp chứa hàng và sản phẩm khi người dùng click vào bất kỳ nơi nào trên trang web ngoại trừ nút "POSSITION"
        document.addEventListener('click', function (event) {
            var targetElement = event.target;

            // Kiểm tra xem người dùng có click vào nút "POSSITION" hay không
            if (targetElement.id !== 'menuTraCuu' && isRectangle2Visible) {
                // Ẩn rectangle2 và product
                isRectangle2Visible = false;
            }
        });


        //Giúp ẩn đi nút khi người dùng click vào bất kỳ nơi nào trên trang web ngoại trừ nút "Floor2"
        document.addEventListener('click', function (event) {
            var targetElement = event.target;

            // Kiểm tra xem người dùng có click vào nút "Floor2" hay không
            if (targetElement.id !== 'Floor 2 (${productCount}P/${anchorCount}A)' && isRectangle2Visible) {
                // Ẩn rectangle2 và product
                isRectangle2Visible = false;
            }
        });

        
        
        //Popup của Product trong Menu Posistion
        function showProductDetails(productId, productDetailsKey) {
            db.ref('/Building 1/floor2/product/' + productId + '/details').once('value', function (snapshot) {
                var data = snapshot.val();

                Swal.fire({
                    title: 'Tag informations',
                    html: `
                        <p><strong>ID:</strong> ${data.ID || 'N/A'}</p>
                        <p><strong>Building:</strong> ${data.building || 'N/A'}</p>
                        <p><strong>Floor:</strong> ${data.floor || 'N/A'}</p>
                        <p><strong>Tag:</strong> ${data.tag || 'N/A'}</p>
                        <p><strong>Time:</strong> ${data.time || 'N/A'}</p>
                    `,
                    showCloseButton: true,
                    showConfirmButton: false,
                    backdrop: false,
                    customClass: {
                        popup: 'custom-popup'
                    }
                });
            });
        }
        
        
        //Tải dữ liệu của Products và Anchors từ Firebase
        document.addEventListener('DOMContentLoaded', function () {
            // Duyệt qua dữ liệu trong 'product'
            db.ref('/Building 1/floor2/product').on('value', function (productSnapshot) {
                productSnapshot.forEach(function (childSnapshot) {
                    var productId = childSnapshot.key;
                    var product = document.getElementById(productId);
                    if (product) {
                        updateproductPosition(childSnapshot, productId);
                    }
                });
            });

            // Duyệt qua dữ liệu trong 'anchor'
            db.ref('/Building 1/floor2/anchor').on('value', function (anchorSnapshot) {
                anchorSnapshot.forEach(function (childSnapshot) {
                    var anchorId = childSnapshot.key;
                    var anchor = document.getElementById(anchorId);
                    if (anchor) {
                        updateAnchorPosition(childSnapshot, anchorId);
                    }
                });
            });
        });
        
        
        //Hiển thị anchors và thêm sự kiện khi click vào nó
        document.querySelectorAll('.anchor').forEach(function (anchor, index) {
            anchor.style.display = 'block';
            var anchorId = 'anchor' + (index + 1);

            anchor.addEventListener('click', function() {
                showAnchorDetails(anchorId);
            });
        });
        
        
        // Cập nhật Nội dung của Nút Floor 2
        function updateFloor2ButtonContent(productCount, anchorCount) {
            var floor2Button = document.getElementById('floor2Button');
            floor2Button.textContent = `Floor 2 (${productCount}P/${anchorCount}A)`;
        }

        // Hàm tính tổng số lượng sản phẩm và anchor của tầng 2
        function calculateProductAndAnchorCounts() {
            var productCount = 0;
            var anchorCount = 0;

            // Tính tổng số lượng sản phẩm
            db.ref('/Building 1/floor2/product').once('value', function(productSnapshot) {
                productCount = productSnapshot.numChildren();
                // Cập nhật nội dung của nút Floor 2
                updateFloor2ButtonContent(productCount, anchorCount);
            });

            // Tính tổng số lượng anchor
            db.ref('/Building 1/floor2/anchor').once('value', function(anchorSnapshot) {
                anchorCount = anchorSnapshot.numChildren();
                // Cập nhật nội dung của nút Floor 2
                updateFloor2ButtonContent(productCount, anchorCount);
            });
        }

        // Gọi hàm để tính và cập nhật tổng số lượng sản phẩm và anchor khi trang được tải
        calculateProductAndAnchorCounts();
            
        // Xử lý sự kiện click vào Button Floor 2
        document.getElementById('floor2Button').addEventListener('click', function() {
            // Truy cập dữ liệu tên và địa chỉ từ Firebase
            db.ref('/Building 1/floor2/information').once('value', function(snapshot) {
                var name = snapshot.val().name || 'N/A';
                var address = snapshot.val().address || 'N/A';
                    
                // Tính tổng số lượng sản phẩm từ Firebase
                db.ref('/Building 1/floor2/product').once('value', function(productSnapshot) {
                    var productCount = productSnapshot.numChildren();
                        
                    // Tính tổng số lượng anchor từ Firebase
                    db.ref('/Building 1/floor2/anchor').once('value', function(anchorSnapshot) {
                        var anchorCount = anchorSnapshot.numChildren();
                            
                        // Hiển thị thông tin trong khung thông tin
                        displayFloor2Information(name, address, productCount, anchorCount);
                    });
                });
            });
        });

        // Hàm để hiển thị thông tin trong khung thông tin
        function displayFloor2Information(name, address, productCount, anchorCount) {
            var floor2InfoContainer = document.getElementById('floor2InfoContainer');
                
            // Xây dựng nội dung thông tin
            var infoHTML = `
                <div class="floor2-info">
                    <h3>Floor 2 Information</h3>
                    <p><strong>Name:</strong> ${name}</p>
                    <p><strong>Address:</strong> ${address}</p>
                    <p><strong>Total Products:</strong> ${productCount}</p>
                    <p><strong>Total Anchors:</strong> ${anchorCount}</p>
                </div>
            `;
                
            // Thêm nội dung vào khung thông tin
            floor2InfoContainer.innerHTML = infoHTML;
        }

        var isTableVisible = false;
        document.getElementById('floor2Button').addEventListener('click', function () {
            if (!isTableVisible) {
                // Hiển thị floor2InfoContainer
                document.getElementById('floor2InfoContainer').style.display = 'block';
                
                // Đặt trạng thái của biến isTableVisible thành true
                isTableVisible = true;
            } else {
                // Ẩn floor2InfoContainer
                document.getElementById('floor2InfoContainer').style.display = 'none';
                
                // Đặt trạng thái của biến isTableVisible thành false
                isTableVisible = false;
            }
        });
        // Hàm ẩn floor2InfoContainer và cập nhật trạng thái isTableVisible
        function hideFloor2InfoContainer() {
            document.getElementById('floor2InfoContainer').style.display = 'none';
            isTableVisible = false;
        }

        // Gán hàm hideFloor2InfoContainer cho các sự kiện click của các nút menu tương ứng
        document.getElementById('menuB').addEventListener('click', hideFloor2InfoContainer);
        document.getElementById('menuC').addEventListener('click', hideFloor2InfoContainer);
        document.getElementById('menuA').addEventListener('click', hideFloor2InfoContainer);
