<!DOCTYPE html>
<html lang="en">

<head>
    <!--Tiêu đề trang web-->
    <title>Warehouse Management System</title>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://upload.wikimedia.org/wikipedia/vi/thumb/b/bf/Logo_HUET.svg/1200px-Logo_HUET.svg.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!--Phần Style-->
    <link rel="stylesheet" href="./assets/css/styles.css">

</head>

<body>
    <!--Logo-->
    <img src="https://upload.wikimedia.org/wikipedia/vi/thumb/b/bf/Logo_HUET.svg/1200px-Logo_HUET.svg.png" alt="Logo"
        class="logo">

    <header>
        <h1>WAREHOUSE MANAGEMENT SYSTEM</h1>
    </header>

    <!-- Menu của tôi -->
    <nav>
        <a href="#" id="menuTraCuu">LOCATION</a>

        <button id="floor1Button" style="display: none;">Floor 1</button>
        <button id="floor2Button" style="display: none;">Floor 2</button>

        <a href="#" id="menuC">STATISTICS</a>
        <a href="#" id="menuB">SET ANCHOR POSITION</a>
        
        <a href="#" id="menuA">ABOUT US</a>
    </nav>

    <!--Nút Floor1-->
    <div id="floorButtonContainer"></div>
    <!--Nút Floor2-->
    <div id="floor2ButtonContainer"></div>
    

    <!-- Bảng Thông tin Món hàng trong menu Statistics -->
    <div id="tableContainer" class="centered-table" style="display: none;">
        <table id="productTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Building</th>
                    <th>Floor</th>
                    <th>Tag</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody id="productTableBody"></tbody>
        </table>
        <!-- Thêm nút "Xuất thống kê" -->
        <button id="exportButton" class="export-button">Export Statistics</button>
    </div> 
    

    <!--Footer-->
    <div class="bottom-text">Graduation Thesis _ Ware House Management System </div>

    
    <!--Phần này để hiển thị anchor dưới dạng image-->
    <div id="rectangle">
        <div id="product1" class="product"></div>
        <div id="product2" class="product"></div>
        <div id="product3" class="product"></div>
        <img src="https://toppng.com/uploads/preview/instagram-icon-png-download-white-logo-free-social-instagram-logo-vector-2017-1156285509326avakqhwk.png"
        alt="anchor 1" class="anchor" id="anchor1">
        <img src="https://toppng.com/uploads/preview/instagram-icon-png-download-white-logo-free-social-instagram-logo-vector-2017-1156285509326avakqhwk.png"
        alt="anchor 2" class="anchor" id="anchor2">
        <img src="https://toppng.com/uploads/preview/instagram-icon-png-download-white-logo-free-social-instagram-logo-vector-2017-1156285509326avakqhwk.png"
        alt="anchor 3" class="anchor" id="anchor3">
        <img src="https://toppng.com/uploads/preview/instagram-icon-png-download-white-logo-free-social-instagram-logo-vector-2017-1156285509326avakqhwk.png"
        alt="anchor 4" class="anchor" id="anchor4">
    </div>

    <div id="rectangle2">
        <div id="product4" class="product"></div>
        <div id="product5" class="product"></div>
        <div id="product6" class="product"></div>
        <img src="https://toppng.com/uploads/preview/instagram-icon-png-download-white-logo-free-social-instagram-logo-vector-2017-1156285509326avakqhwk.png"
        alt="anchor 5" class="anchor" id="anchor5">
        <img src="https://toppng.com/uploads/preview/instagram-icon-png-download-white-logo-free-social-instagram-logo-vector-2017-1156285509326avakqhwk.png"
        alt="anchor 6" class="anchor" id="anchor6">
        <img src="https://toppng.com/uploads/preview/instagram-icon-png-download-white-logo-free-social-instagram-logo-vector-2017-1156285509326avakqhwk.png"
        alt="anchor 7" class="anchor" id="anchor7">
        <img src="https://toppng.com/uploads/preview/instagram-icon-png-download-white-logo-free-social-instagram-logo-vector-2017-1156285509326avakqhwk.png"
        alt="anchor 8" class="anchor" id="anchor8">
    </div>

    <!--Phần này để nhập tọa độ cho anchor-->
    <div id="anchorDetails" style="display: none;">
        <label for="xCoordinate">X Coordinates:</label>
        <input type="text" id="xCoordinate" placeholder="Enter X coordinates">
    
        <label for="yCoordinate">Y Coordinates:</label>
        <input type="text" id="yCoordinate" placeholder="Enter Y coordinates">
    
        <button id="saveCoordinates">Lưu</button>
    </div>
    

    <div id="floorInfoContainer" class="floor-info-container" style="display: none;">
        <!-- Nội dung thông tin sẽ được thêm vào đây bằng JavaScript -->
    </div>
    <div id="floor2InfoContainer" class="floor2-info-container" style="display: none;">
        <!-- Nội dung thông tin sẽ được thêm vào đây bằng JavaScript -->
    </div>
    

    <!--Tải hai tệp JavaScript từ Firebase SDK-->
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-database.js"></script>

    
    
    <script>
        //Cấu hình Firebase    
        const firebaseConfig = {
            apiKey: "AIzaSyDsZGUIWm5X8i79CnSnJKwlv4_Pu3q3iuc",
            authDomain: "myfirstfb-65c63.firebaseapp.com",
            databaseURL: "https://myfirstfb-65c63-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "myfirstfb-65c63",
            storageBucket: "myfirstfb-65c63.appspot.com",
            messagingSenderId: "290610857576",
            appId: "1:290610857576:web:593011b529606c2b611ddd",
            measurementId: "G-55Z9TR5GK7"
        };

        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();

        //Theo dõi trạng thái cái phần tử trên trang Web
        var isElementsVisible = false;
        
        //--------------------LOCATION-------------------------
        
        //Truy cập đến map trong menutracuu
        var rectangleElement = document.getElementById('rectangle');
        var rectangle2Element = document.getElementById('rectangle2');

        //Theo dõi trạng thái của Button floor 1
        var isFloor1Clicked = false;
        //Theo dõi trạng thái của Button floor 2
        var isFloor2Clicked = false;

        //Hiển thị product trên Map
        document.querySelectorAll('.product').forEach(function (product, index) {
            product.style.display = 'block';
            var productId = 'product' + (index + 1);

            db.ref('/Building 1/floor1/product').once('value', function(productSnapshot) {
                updateproductPosition(productSnapshot.child(productId).val(), product.id);
            });

            product.addEventListener('click', function () {
                showProductDetails(productId, 'productDetails');
            });
        });
        //Hiển thị anchor trên map
        document.querySelectorAll('.anchor').forEach(function (anchor, index) {
            anchor.style.display = 'block';
            var anchorId = 'anchor' + (index + 1);

            db.ref('/Building 1/floor1/anchor').once('value', function(anchorSnapshot) {
                updateAnchorPosition(anchorSnapshot.child(anchorId).val(), anchor.id);
            });

        });

        //Hiển thị product trên Map1
        document.querySelectorAll('.product').forEach(function (product, index) {
            product.style.display = 'block';
            var productId = 'product' + (index + 1);

            db.ref('/Building 1/floor2/product').once('value', function(productSnapshot) {
                updateproductPosition(productSnapshot.child(productId).val(), product.id);
            });

            product.addEventListener('click', function () {
                showProductDetails(productId, 'productDetails');
            });
        });
        //Hiển thị anchor trên map2
        document.querySelectorAll('.anchor').forEach(function (anchor, index) {
            anchor.style.display = 'block';
            var anchorId = 'anchor' + (index + 1);

            db.ref('/Building 1/floor2/anchor').once('value', function(anchorSnapshot) {
                updateAnchorPosition(anchorSnapshot.child(anchorId).val(), anchor.id);
            });

        });


        //Khi bắt đầu, các phần tử rectangle, product, anchor ẩn đi. 
        window.onload = function() {
            rectangleElement.style.display = 'none';
            document.querySelectorAll('.product').forEach(function (product) {
                product.style.display = 'none';
            });
            document.querySelectorAll('.anchor').forEach(function (anchor) {
                anchor.style.display = 'none';
            });
        }

        //Khi bắt đầu, các phần tử rectangle2, product, anchor ẩn đi. 
        window.onload = function() {
            rectangle2Element.style.display = 'none';
            document.querySelectorAll('.product').forEach(function (product) {
                product.style.display = 'none';
            });
            document.querySelectorAll('.anchor').forEach(function (anchor) {
                anchor.style.display = 'none';
            });
        }



        // Khi bắt đầu, các phần tử rectangle, product, anchor ẩn đi. 
        var menuTraCuu = document.getElementById('menuTraCuu');
        rectangleElement.style.display = 'none';
        document.querySelectorAll('.product').forEach(function (product) {
            product.style.display = 'none';
        });
        document.querySelectorAll('.anchor').forEach(function (anchor) {
            anchor.style.display = 'none';
        });


        // Khi bắt đầu, các phần tử rectangle2, product, anchor ẩn đi. 
        var menuTraCuu = document.getElementById('menuTraCuu');
        rectangle2Element.style.display = 'none';
        document.querySelectorAll('.product').forEach(function (product) {
            product.style.display = 'none';
        });
        document.querySelectorAll('.anchor').forEach(function (anchor) {
            anchor.style.display = 'none';
        });


        // Lắng nghe sự kiện click vào liên kết "Location"
        menuTraCuu.addEventListener('click', function() {
            // Hiển thị nút "Tầng 1" khi click vào liên kết "Location"
            floor1Button.style.display = 'block';
            // Đặt trạng thái của nút "Tầng 1" về false khi click vào liên kết "Location"
            isFloor1Clicked = false;
        });


        // Lắng nghe sự kiện click vào liên kết "Location"
        menuTraCuu.addEventListener('click', function() {
            // Hiển thị nút "Tầng 2" khi click vào liên kết "Location"
            floor2Button.style.display = 'block';
            // Đặt trạng thái của nút "Tầng 2" về false khi click vào liên kết "Location"
            isFloor2Clicked = false;
        });


        //Nút Floor 1
        menuTraCuu.addEventListener('click', function() {
            // Tạo một phần tử button mới
            var floor1Button = document.createElement('button');
            floor1Button.textContent = 'Floor 1';
            floor1Button.id = 'floor1Button';

            // Thêm sự kiện click cho nút "Floor 1" nếu bạn muốn xử lý một hành động cụ thể khi nút này được click
            var floor1Button = document.getElementById('floor1Button');

            floor1Button.addEventListener('click', function() {
                // Nếu chưa click vào nút "Tầng 1" trước đó
                if (!isFloor1Clicked) {
                    // Hiển thị các phần tử khi click vào nút "Tầng 1"
                    rectangleElement.style.display = 'block';
                    document.querySelectorAll('.product').forEach(function (product) {
                        product.style.display = 'block';
                    });
                    document.querySelectorAll('.anchor').forEach(function (anchor) {
                        anchor.style.display = 'block';
                    });
                    
                    // Cập nhật trạng thái đã click vào nút "Tầng 1"
                    isFloor1Clicked = true;
                } else {
                    // Nếu click vào nút "Tầng 1" trước đó, ấn vào nút lần nữa sẽ ẩn đi các phần tử
                    rectangleElement.style.display = 'none';
                    document.querySelectorAll('.product').forEach(function (product) {
                        product.style.display = 'none';
                    });
                    document.querySelectorAll('.anchor').forEach(function (anchor) {
                        anchor.style.display = 'none';
                    });
                    
                    // Cập nhật trạng thái đã click vào nút "Tầng 1"
                    isFloor1Clicked = false;
                }
            });


            // Thêm nút "Floor 1" vào phần tử chứa
            var floorButtonContainer = document.getElementById('floorButtonContainer');
            floorButtonContainer.innerHTML = ''; // Xóa bất kỳ nút nào đã tồn tại trước đó
            floorButtonContainer.appendChild(floor1Button);
        });

        //Nút Floor 2
        menuTraCuu.addEventListener('click', function() {
            // Tạo một phần tử button mới
            var floor2Button = document.createElement('button');
            floor2Button.textContent = 'Floor 2';
            floor2Button.id = 'floor2Button';

            // Thêm sự kiện click cho nút "Floor 2" nếu bạn muốn xử lý một hành động cụ thể khi nút này được click
            var floor2Button = document.getElementById('floor2Button');

            floor2Button.addEventListener('click', function() {
                // Nếu chưa click vào nút "Tầng 2" trước đó
                if (!isFloor2Clicked) {
                    // Hiển thị các phần tử khi click vào nút "Tầng 1"
                    rectangle2Element.style.display = 'block';
                    document.querySelectorAll('.product').forEach(function (product) {
                        product.style.display = 'block';
                    });
                    document.querySelectorAll('.anchor').forEach(function (anchor) {
                        anchor.style.display = 'block';
                    });
                    
                    // Cập nhật trạng thái đã click vào nút "Tầng 2"
                    isFloor2Clicked = true;
                } else {
                    // Nếu click vào nút "Tầng 2" trước đó, ấn vào nút lần nữa sẽ ẩn đi các phần tử
                    rectangle2Element.style.display = 'none';
                    document.querySelectorAll('.product').forEach(function (product) {
                        product.style.display = 'none';
                    });
                    document.querySelectorAll('.anchor').forEach(function (anchor) {
                        anchor.style.display = 'none';
                    });
                    
                    // Cập nhật trạng thái đã click vào nút "Tầng 2"
                    isFloor2Clicked = false;
                }
            });


            // Thêm nút "Floor 2" vào phần tử chứa
            var floor2ButtonContainer = document.getElementById('floor2ButtonContainer');
            floor2ButtonContainer.innerHTML = ''; // Xóa bất kỳ nút nào đã tồn tại trước đó
            floor2ButtonContainer.appendChild(floor2Button);
        });


        
        //Show pop-up khi click vào anchor ở Location
        function showAnchorDetails(anchorId, anchorDetailsKey) {
            db.ref('/Building 1/floor1/anchor/' + anchorId).once('value', function (snapshot) {
                var data = snapshot.val();
                if (data && data.coordinates) {
                    var coordinates = data.coordinates;
                    Swal.fire({
                        title: 'Anchor informations',
                        html: `
                            <p><strong>X Coordinates:</strong> ${coordinates.x || 'N/A'}</p>
                            <p><strong>Y Coordinates:</strong> ${coordinates.y || 'N/A'}</p>
                        `,
                        showCloseButton: true,
                        showConfirmButton: false,
                        backdrop: false,
                        customClass: {
                            popup: 'custom-popup'
                        }
                    });
                } else {
                    Swal.fire({
                        title: 'Anchor informations',
                        html: `
                            <p>Anchor details not found.</p>
                        `,
                        showCloseButton: true,
                        showConfirmButton: false,
                        backdrop: false,
                        customClass: {
                            popup: 'custom-popup'
                        }
                    });
                }
            });
        }


        //Show pop-up khi click vào anchor ở Location
        function showAnchorDetails(anchorId, anchorDetailsKey) {
            db.ref('/Building 1/floor2/anchor/' + anchorId).once('value', function (snapshot) {
                var data = snapshot.val();
                if (data && data.coordinates) {
                    var coordinates = data.coordinates;
                    Swal.fire({
                        title: 'Anchor informations',
                        html: `
                            <p><strong>X Coordinates:</strong> ${coordinates.x || 'N/A'}</p>
                            <p><strong>Y Coordinates:</strong> ${coordinates.y || 'N/A'}</p>
                        `,
                        showCloseButton: true,
                        showConfirmButton: false,
                        backdrop: false,
                        customClass: {
                            popup: 'custom-popup'
                        }
                    });
                } else {
                    Swal.fire({
                        title: 'Anchor informations',
                        html: `
                            <p>Anchor details not found.</p>
                        `,
                        showCloseButton: true,
                        showConfirmButton: false,
                        backdrop: false,
                        customClass: {
                            popup: 'custom-popup'
                        }
                    });
                }
            });
        }


        //MENU POSISTION
        var isRectangleVisible = false;
        // Xử lý sự kiện click vào nút "POSISTION"
        document.getElementById('menuTraCuu').addEventListener('click', function () {
            if (!isRectangleVisible) {
                // Hiển thị rectangle, product và anchor
                rectangleElement.style.display = 'block';
                document.querySelectorAll('.product').forEach(function (product, index) {
                    product.style.display = 'block';
                });
                document.querySelectorAll('.anchor').forEach(function (anchor, index) {
                    anchor.style.display = 'block';
                });
                
                // Hiển thị floorInfoContainer
                document.getElementById('floorInfoContainer').style.display = 'block';
                
                // Cập nhật trạng thái của biến isTableVisible thành true
                isTableVisible = true;

                // Cập nhật trạng thái của rectangle
                isRectangleVisible = true;
            } else {
                // Ẩn rectangle, product và anchor
                rectangleElement.style.display = 'none';
                document.querySelectorAll('.product').forEach(function (product) {
                    product.style.display = 'none';
                });
                document.querySelectorAll('.anchor').forEach(function (anchor) {
                    anchor.style.display = 'none';
                });

                // Ẩn floorInfoContainer
                document.getElementById('floorInfoContainer').style.display = 'none';
                
                // Đặt trạng thái của biến isTableVisible thành false
                isTableVisible = false;

                // Cập nhật trạng thái của rectangle
                isRectangleVisible = false;
            }
        });


        //MENU POSISTION
        var isRectangle2Visible = false;
        // Xử lý sự kiện click vào nút "POSISTION"
        document.getElementById('menuTraCuu').addEventListener('click', function () {
            if (!isRectangle2Visible) {
                // Hiển thị rectangle2, product và anchor
                rectangle2Element.style.display = 'block';
                document.querySelectorAll('.product').forEach(function (product, index) {
                    product.style.display = 'block';
                });
                document.querySelectorAll('.anchor').forEach(function (anchor, index) {
                    anchor.style.display = 'block';
                });
                
                // Hiển thị floor2InfoContainer
                document.getElementById('floor2InfoContainer').style.display = 'block';
                
                // Cập nhật trạng thái của biến isTableVisible thành true
                isTableVisible = true;

                // Cập nhật trạng thái của rectangle2
                isRectangle2Visible = true;
            } else {
                // Ẩn rectangle2, product và anchor
                rectangle2Element.style.display = 'none';
                document.querySelectorAll('.product').forEach(function (product) {
                    product.style.display = 'none';
                });
                document.querySelectorAll('.anchor').forEach(function (anchor) {
                    anchor.style.display = 'none';
                });

                // Ẩn floor2InfoContainer
                document.getElementById('floor2InfoContainer').style.display = 'none';
                
                // Đặt trạng thái của biến isTableVisible thành false
                isTableVisible = false;

                // Cập nhật trạng thái của rectangle2
                isRectangle2Visible = false;
            }
        });


        //Dùng để hiển thị Anchors và Products
        function updateAnchorPosition(anchorSnapshot, anchorId) {
            var anchorElement = document.getElementById(anchorId);
            var xCoordinate = anchorSnapshot.val().coordinates.x || 0;
            var yCoordinate = anchorSnapshot.val().coordinates.y || 0;

            anchorElement.style.left = xCoordinate + 'px';
            anchorElement.style.top = yCoordinate + 'px';
        }

        function updateproductPosition(productSnapshot, productId) {
            var productElement = document.getElementById(productId);
            var xCoordinate = productSnapshot.val().coordinates.x || 0;
            var yCoordinate = productSnapshot.val().coordinates.y || 0;

            productElement.style.left = xCoordinate + 'px';
            productElement.style.top = yCoordinate + 'px';
        }



        //Giúp ẩn đi hộp chứa hàng và sản phẩm khi người dùng click vào bất kỳ nơi nào trên trang web ngoại trừ nút "POSSITION"
        document.addEventListener('click', function (event) {
            var targetElement = event.target;

            // Kiểm tra xem người dùng có click vào nút "POSSITION" hay không
            if (targetElement.id !== 'menuTraCuu' && isRectangleVisible) {
                // Ẩn rectangle và product
                isRectangleVisible = false;
            }
        });

        //Giúp ẩn đi hộp chứa hàng và sản phẩm khi người dùng click vào bất kỳ nơi nào trên trang web ngoại trừ nút "POSSITION"
        document.addEventListener('click', function (event) {
            var targetElement = event.target;

            // Kiểm tra xem người dùng có click vào nút "POSSITION" hay không
            if (targetElement.id !== 'menuTraCuu' && isRectangle2Visible) {
                // Ẩn rectangle2 và product
                isRectangle2Visible = false;
            }
        });


        //Giúp ẩn đi nút khi người dùng click vào bất kỳ nơi nào trên trang web ngoại trừ nút "Floor1"
        document.addEventListener('click', function (event) {
            var targetElement = event.target;

            // Kiểm tra xem người dùng có click vào nút "Floor1" hay không
            if (targetElement.id !== 'Floor 1 (${productCount}P/${anchorCount}A)' && isRectangleVisible) {
                // Ẩn rectangle và product
                isRectangleVisible = false;
            }
        });
        //Giúp ẩn đi nút khi người dùng click vào bất kỳ nơi nào trên trang web ngoại trừ nút "Floor2"
        document.addEventListener('click', function (event) {
            var targetElement = event.target;

            // Kiểm tra xem người dùng có click vào nút "Floor2" hay không
            if (targetElement.id !== 'Floor 2 (${productCount2}P/${anchorCount2}A)' && isRectangle2Visible) {
                // Ẩn rectangle2 và product
                isRectangle2Visible = false;
            }
        });

        
        
        //Popup của Product trong Menu Posistion
        function showProductDetails(productId, productDetailsKey) {
            db.ref('/Building 1/floor1/product/' + productId + '/details').once('value', function (snapshot) {
                var data = snapshot.val();

                Swal.fire({
                    title: 'Tag informations',
                    html: `
                        <p><strong>ID:</strong> ${data.ID || 'N/A'}</p>
                        <p><strong>Building:</strong> ${data.building || 'N/A'}</p>
                        <p><strong>Floor:</strong> ${data.floor || 'N/A'}</p>
                        <p><strong>Tag:</strong> ${data.tag || 'N/A'}</p>
                        <p><strong>Time:</strong> ${data.time || 'N/A'}</p>
                    `,
                    showCloseButton: true,
                    showConfirmButton: false,
                    backdrop: false,
                    customClass: {
                        popup: 'custom-popup'
                    }
                });
            });
        }
        //Popup của Product trong Menu Posistion
        function showProductDetails(productId, productDetailsKey) {
            db.ref('/Building 1/floor2/product/' + productId + '/details').once('value', function (snapshot) {
                var data = snapshot.val();

                Swal.fire({
                    title: 'Tag informations',
                    html: `
                        <p><strong>ID:</strong> ${data.ID || 'N/A'}</p>
                        <p><strong>Building:</strong> ${data.building || 'N/A'}</p>
                        <p><strong>Floor:</strong> ${data.floor || 'N/A'}</p>
                        <p><strong>Tag:</strong> ${data.tag || 'N/A'}</p>
                        <p><strong>Time:</strong> ${data.time || 'N/A'}</p>
                    `,
                    showCloseButton: true,
                    showConfirmButton: false,
                    backdrop: false,
                    customClass: {
                        popup: 'custom-popup'
                    }
                });
            });
        }
        
        //Tải dữ liệu của Products và Anchors từ Firebase
        document.addEventListener('DOMContentLoaded', function () {
            // Duyệt qua dữ liệu trong 'product'
            db.ref('/Building 1/floor1/product').on('value', function (productSnapshot) {
                productSnapshot.forEach(function (childSnapshot) {
                    var productId = childSnapshot.key;
                    var product = document.getElementById(productId);
                    if (product) {
                        updateproductPosition(childSnapshot, productId);
                    }
                });
            });

            // Duyệt qua dữ liệu trong 'anchor'
            db.ref('/Building 1/floor1/anchor').on('value', function (anchorSnapshot) {
                anchorSnapshot.forEach(function (childSnapshot) {
                    var anchorId = childSnapshot.key;
                    var anchor = document.getElementById(anchorId);
                    if (anchor) {
                        updateAnchorPosition(childSnapshot, anchorId);
                    }
                });
            });
        });
        //Tải dữ liệu của Products và Anchors từ Firebase
        document.addEventListener('DOMContentLoaded', function () {
            // Duyệt qua dữ liệu trong 'product'
            db.ref('/Building 1/floor2/product').on('value', function (productSnapshot) {
                productSnapshot.forEach(function (childSnapshot) {
                    var productId = childSnapshot.key;
                    var product = document.getElementById(productId);
                    if (product) {
                        updateproductPosition(childSnapshot, productId);
                    }
                });
            });

            // Duyệt qua dữ liệu trong 'anchor'
            db.ref('/Building 1/floor2/anchor').on('value', function (anchorSnapshot) {
                anchorSnapshot.forEach(function (childSnapshot) {
                    var anchorId = childSnapshot.key;
                    var anchor = document.getElementById(anchorId);
                    if (anchor) {
                        updateAnchorPosition(childSnapshot, anchorId);
                    }
                });
            });
        });
        
        //Hiển thị anchors và thêm sự kiện khi click vào nó
        document.querySelectorAll('.anchor').forEach(function (anchor, index) {
            anchor.style.display = 'block';
            var anchorId = 'anchor' + (index + 1);

            anchor.addEventListener('click', function() {
                showAnchorDetails(anchorId);
            });
        });
        //Hiển thị anchors và thêm sự kiện khi click vào nó
        document.querySelectorAll('.anchor').forEach(function (anchor, index) {
            anchor.style.display = 'block';
            var anchorId = 'anchor' + (index + 1);

            anchor.addEventListener('click', function() {
                showAnchorDetails(anchorId);
            });
        });
        
        
        // Cập nhật Nội dung của Nút Floor 1
        function updateFloorButtonContent(productCount, anchorCount) {
            var floorButton = document.getElementById('floor1Button');
            floorButton.textContent = `Floor 1 (${productCount}P/${anchorCount}A)`;
        }
        // Cập nhật Nội dung của Nút Floor 2
        function updateFloor2ButtonContent(productCount2, anchorCount2) {
            var floor2Button = document.getElementById('floor2Button');
            floor2Button.textContent = `Floor 2 (${productCount2}P/${anchorCount2}A)`;
        }

        // Hàm tính tổng số lượng sản phẩm và anchor của tầng 1
        function calculateProductAndAnchorCounts() {
            var productCount = 0;
            var anchorCount = 0;

            // Tính tổng số lượng sản phẩm
            db.ref('/Building 1/floor1/product').once('value', function(productSnapshot) {
                productCount = productSnapshot.numChildren();
                // Cập nhật nội dung của nút Floor 1
                updateFloorButtonContent(productCount, anchorCount);
            });

            // Tính tổng số lượng anchor
            db.ref('/Building 1/floor1/anchor').once('value', function(anchorSnapshot) {
                anchorCount = anchorSnapshot.numChildren();
                // Cập nhật nội dung của nút Floor 1
                updateFloorButtonContent(productCount, anchorCount);
            });
        }
        // Hàm tính tổng số lượng sản phẩm và anchor của tầng 2
        function calculateProductAndAnchorCounts() {
            var productCount2 = 0;
            var anchorCount2 = 0;

            // Tính tổng số lượng sản phẩm
            db.ref('/Building 1/floor2/product').once('value', function(productSnapshot) {
                productCount2 = productSnapshot.numChildren();
                // Cập nhật nội dung của nút Floor 2
                updateFloor2ButtonContent(productCount2, anchorCount2);
            });

            // Tính tổng số lượng anchor
            db.ref('/Building 1/floor2/anchor').once('value', function(anchorSnapshot) {
                anchorCount2 = anchorSnapshot.numChildren();
                // Cập nhật nội dung của nút Floor 2
                updateFloor2ButtonContent(productCount2, anchorCount2);
            });
        }

        // Gọi hàm để tính và cập nhật tổng số lượng sản phẩm và anchor khi trang được tải
        calculateProductAndAnchorCounts();
            
        // Xử lý sự kiện click vào Button Floor 1
        document.getElementById('floor1Button').addEventListener('click', function() {
            // Truy cập dữ liệu tên và địa chỉ từ Firebase
            db.ref('/Building 1/floor1/information').once('value', function(snapshot) {
                var name = snapshot.val().name || 'N/A';
                var address = snapshot.val().address || 'N/A';
                    
                // Tính tổng số lượng sản phẩm từ Firebase
                db.ref('/Building 1/floor1/product').once('value', function(productSnapshot) {
                    var productCount = productSnapshot.numChildren();
                        
                    // Tính tổng số lượng anchor từ Firebase
                    db.ref('/Building 1/floor1/anchor').once('value', function(anchorSnapshot) {
                        var anchorCount = anchorSnapshot.numChildren();
                            
                        // Hiển thị thông tin trong khung thông tin
                        displayFloorInformation(name, address, productCount, anchorCount);
                    });
                });
            });
        });
        // Gọi hàm để tính và cập nhật tổng số lượng sản phẩm và anchor khi trang được tải
        calculateProductAndAnchorCounts2();
            
        // Xử lý sự kiện click vào Button Floor 2
        document.getElementById('floor2Button').addEventListener('click', function() {
            // Truy cập dữ liệu tên và địa chỉ từ Firebase
            db.ref('/Building 1/floor2/information').once('value', function(snapshot) {
                var name = snapshot.val().name || 'N/A';
                var address = snapshot.val().address || 'N/A';
                    
                // Tính tổng số lượng sản phẩm từ Firebase
                db.ref('/Building 1/floor2/product').once('value', function(productSnapshot) {
                    var productCount2 = productSnapshot.numChildren();
                        
                    // Tính tổng số lượng anchor từ Firebase
                    db.ref('/Building 1/floor2/anchor').once('value', function(anchorSnapshot) {
                        var anchorCount2 = anchorSnapshot.numChildren();
                            
                        // Hiển thị thông tin trong khung thông tin
                        displayFloor2Information(name, address, productCount2, anchorCount2);
                    });
                });
            });
        });

        // Hàm để hiển thị thông tin trong khung thông tin
        function displayFloorInformation(name, address, productCount, anchorCount) {
            var floorInfoContainer = document.getElementById('floorInfoContainer');
                
            // Xây dựng nội dung thông tin
            var infoHTML = `
                <div class="floor-info">
                    <h3>Floor Information</h3>
                    <p><strong>Name:</strong> ${name}</p>
                    <p><strong>Address:</strong> ${address}</p>
                    <p><strong>Total Products:</strong> ${productCount}</p>
                    <p><strong>Total Anchors:</strong> ${anchorCount}</p>
                </div>
            `;
                
            // Thêm nội dung vào khung thông tin
            floorInfoContainer.innerHTML = infoHTML;
        }
        // Hàm để hiển thị thông tin trong khung thông tin
        function displayFloor2Information(name, address, productCount2, anchorCount2) {
            var floor2InfoContainer = document.getElementById('floor2InfoContainer');
                
            // Xây dựng nội dung thông tin
            var infoHTML = `
                <div class="floor2-info">
                    <h3>Floor 2 Information</h3>
                    <p><strong>Name:</strong> ${name}</p>
                    <p><strong>Address:</strong> ${address}</p>
                    <p><strong>Total Products:</strong> ${productCount2}</p>
                    <p><strong>Total Anchors:</strong> ${anchorCount2}</p>
                </div>
            `;
                
            // Thêm nội dung vào khung thông tin
            floor2InfoContainer.innerHTML = infoHTML;
        }

        var isTableVisible = false;
        document.getElementById('floor1Button').addEventListener('click', function () {
            if (!isTableVisible) {
                // Hiển thị floorInfoContainer
                document.getElementById('floorInfoContainer').style.display = 'block';
                
                // Đặt trạng thái của biến isTableVisible thành true
                isTableVisible = true;
            } else {
                // Ẩn floorInfoContainer
                document.getElementById('floorInfoContainer').style.display = 'none';
                
                // Đặt trạng thái của biến isTableVisible thành false
                isTableVisible = false;
            }
        });
        var isTableVisible = false;
        document.getElementById('floor2Button').addEventListener('click', function () {
            if (!isTableVisible) {
                // Hiển thị floor2InfoContainer
                document.getElementById('floor2InfoContainer').style.display = 'block';
                
                // Đặt trạng thái của biến isTableVisible thành true
                isTableVisible = true;
            } else {
                // Ẩn floor2InfoContainer
                document.getElementById('floor2InfoContainer').style.display = 'none';
                
                // Đặt trạng thái của biến isTableVisible thành false
                isTableVisible = false;
            }
        });

        // Hàm ẩn floorInfoContainer và cập nhật trạng thái isTableVisible
        function hideFloorInfoContainer() {
            document.getElementById('floorInfoContainer').style.display = 'none';
            isTableVisible = false;
        }

        // Gán hàm hideFloorInfoContainer cho các sự kiện click của các nút menu tương ứng
        document.getElementById('menuB').addEventListener('click', hideFloorInfoContainer);
        document.getElementById('menuC').addEventListener('click', hideFloorInfoContainer);
        document.getElementById('menuA').addEventListener('click', hideFloorInfoContainer);
        // Hàm ẩn floor2InfoContainer và cập nhật trạng thái isTableVisible
        function hideFloor2InfoContainer() {
            document.getElementById('floor2InfoContainer').style.display = 'none';
            isTableVisible = false;
        }

        // Gán hàm hideFloor2InfoContainer cho các sự kiện click của các nút menu tương ứng
        document.getElementById('menuB').addEventListener('click', hideFloor2InfoContainer);
        document.getElementById('menuC').addEventListener('click', hideFloor2InfoContainer);
        document.getElementById('menuA').addEventListener('click', hideFloor2InfoContainer);




        //--------------------STATISTICS-------------------------
                //Truy cập đến bảng trong menu statistics
                var tableContainer = document.getElementById('tableContainer');
        //Menu Statistics
        document.getElementById('menuC').addEventListener('click', function () {
            if (!isTableVisible) {
                // Hiển thị bảng thống kê
                showProductTable();
                isTableVisible = true;
            } else {
                // Ẩn bảng thống kê
                document.getElementById('tableContainer').style.display = 'none';
                isTableVisible = false;
            }

            // Ẩn rectangle và product
            rectangleElement.style.display = 'none';
            document.querySelectorAll('.product').forEach(function (product) {
                product.style.display = 'none';
            });

            // Đặt trạng thái của rectangle là không hiển thị
            isRectangleVisible = false;

            // Ẩn các anchor
            const anchors = document.querySelectorAll('.anchor');
            anchors.forEach(function (anchor) {
                anchor.style.display = 'none';
            });
            document.getElementById('floor1Button').style.display = 'none';
        });
        //Phần này để ẩn bảng thống kê khi click vào vùng bất kì
        document.addEventListener('click', function (event) {
            var targetElement = event.target;
            // Kiểm tra xem người dùng có click vào nút "Thống kê các món hàng trong kho" hay không
            if (targetElement.id !== 'menuC' && isTableVisible) {
                // Ẩn bảng thống kê
                document.getElementById('tableContainer').style.display = 'none';
                isTableVisible = false;
            }
        });
        //XUẤT THỐNG KÊ
        // Thêm sự kiện cho nút "Xuất thống kê"
        document.getElementById('exportButton').addEventListener('click', function () {
            exportStatistics();
        });

        // Hàm xuất thống kê ra file TXT
        function exportStatistics() {
            var productTableBody = document.getElementById('productTableBody');
            var dataToExport = '';

            // Lặp qua từng hàng trong bảng thống kê và thu thập dữ liệu
            for (var i = 0; i < productTableBody.rows.length; i++) {
                var cells = productTableBody.rows[i].cells;
                for (var j = 0; j < cells.length; j++) {
                    dataToExport += cells[j].innerText + '\t'; // Sử dụng ký tự tab để tách dữ liệu
                }
                dataToExport += '\n'; // Xuống dòng sau mỗi hàng
            }

            // Tạo một đối tượng Blob từ chuỗi dữ liệu
            var blob = new Blob([dataToExport], { type: 'text/plain' });

            // Tạo một đường dẫn URL để tải xuống
            var url = window.URL.createObjectURL(blob);

            // Tạo một thẻ a để tạo sự kiện click và tải xuống
            var a = document.createElement('a');
            a.href = url;
            a.download = 'warehouse_statistics.txt'; // Tên file xuất thống kê
            document.body.appendChild(a);
            a.click();

            // Xóa thẻ a sau khi đã tải xuống
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        // Hàm hiển thị bảng thông tin món hàng trong menu Statistics
        function showProductTable() {
            // Hiển thị bảng thông tin món hàng
            document.getElementById('tableContainer').style.display = 'block';

            db.ref('/Building 1/floor1/product').once('value', function (snapshot) {
                var productTableBody = document.getElementById('productTableBody');
                productTableBody.innerHTML = '';

                snapshot.forEach(function (childSnapshot) {
                    var data = childSnapshot.val();
                    if (data && data.details) {
                        var row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${data.details.ID || 'N/A'}</td>
                            <td>${data.details.building || 'N/A'}</td>
                            <td>${data.details.floor || 'N/A'}</td>
                            <td>${data.details.tag || 'N/A'}</td>
                            <td>${data.details.time || 'N/A'}</td>
                        `;
                        productTableBody.appendChild(row);
                    }
                });
            });
        }


        //--------------------SET ANCHOR POSISTION-------------------------
            //Menu Set Anchor Posistion
            document.getElementById('menuB').addEventListener('click', function () {
            // Hiển thị dropdown danh sách anchor
            Swal.fire({
                title: 'Select Anchor',
                input: 'select',
                inputOptions: {
                    'anchor1': 'Anchor 1',
                    'anchor2': 'Anchor 2',
                    'anchor3': 'Anchor 3',
                    'anchor4': 'Anchor 4'
                    // Thêm các anchor khác nếu cần
                },
                showCloseButton: true,
                showConfirmButton: true,
                confirmButtonText: 'Next',
                preConfirm: (selectedanchor) => {
                    // Kiểm tra xem có chọn anchor nào không
                    if (!selectedanchor) {
                        Swal.showValidationMessage('Please choose an Anchor');
                    } else {
                        // Gọi hàm để nhập tọa độ mới cho anchor đã chọn
                        showCoordinateInput(selectedanchor);
                    }
                }
            });            
            
            // Ẩn rectangle và product
            rectangleElement.style.display = 'none';
            document.querySelectorAll('.product').forEach(function (product) {
                product.style.display = 'none';
            });

            // Đặt trạng thái của rectangle là không hiển thị
            isRectangleVisible = false;

            // Ẩn các anchor
            const anchors = document.querySelectorAll('.anchor');
            anchors.forEach(function (anchor) {
                anchor.style.display = 'none';
            });
            document.getElementById('floor1Button').style.display = 'none';
        });
        //Nhập tọa độ mới cho Anchor trong Menu Set Anchor Posistion
        function showCoordinateInput(selectedanchor) {
            // Hiển thị hộp thoại nhập tọa độ
            Swal.fire({
                title: `Enter coordinates for anchor`,
                html: `
                    <label for="newXCoordinate">X Coordinates:</label>
                    <input type="text" id="newXCoordinate" placeholder="Coordinates for X">

                    <label for="newYCoordinate">Y Coordinates:</label>
                    <input type="text" id="newYCoordinate" placeholder="Coordinates for Y">
                `,
                showCloseButton: true,
                showConfirmButton: true,
                confirmButtonText: 'Save',
                preConfirm: () => {
                    // Lấy giá trị tọa độ mới từ input
                    const newXCoordinate = document.getElementById('newXCoordinate').value;
                    const newYCoordinate = document.getElementById('newYCoordinate').value;

                    // Kiểm tra xem tọa độ có hợp lệ không
                    if (!newXCoordinate || !newYCoordinate) {
                        Swal.showValidationMessage('Please enter full coordinates.');
                    } else {
                        // Cập nhật tọa độ mới lên Firebase cho anchor đã chọn
                        updateanchorCoordinates(selectedanchor, newXCoordinate, newYCoordinate);
                    }
                }
            });
        }    
        // Cập nhật tọa độ mới cho Anchor trong Menu Set Anchor Posistion
        function updateanchorCoordinates(selectedanchor, newX, newY) {
            // Cập nhật tọa độ mới lên Firebase
            db.ref(`/Building 1/floor1/anchor/${selectedanchor}/coordinates`).set({
                x: newX,
                y: newY
            })
            .then(() => {
                Swal.fire('Notice', 'Updated coordinates successfully!', 'success');
            })
            .catch((error) => {
                console.error('Lỗi cập nhật tọa độ:', error);
                Swal.fire('Notice', 'An error occurred while updating coordinates.', 'error');
            });
        }


        //--------------------ABOUT US-------------------------

        //Menu About Us
        var isTableVisible = false;
        document.getElementById('menuA').addEventListener('click', function () {
            // Ẩn rectangle và product
            rectangleElement.style.display = 'none';
            document.querySelectorAll('.product').forEach(function (product) {
                product.style.display = 'none';
            });

            // Đặt trạng thái của rectangle là không hiển thị
            isRectangleVisible = false;

            // Ẩn các anchor
            const anchors = document.querySelectorAll('.anchor');
            anchors.forEach(function (anchor) {
                anchor.style.display = 'none';
            });
            document.getElementById('floor1Button').style.display = 'none';
        });

    </script>
</body>

</html>

